name: Android Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. KÃ“D LETÃ–LTÃ‰SE
    - name: Checkout code
      uses: actions/checkout@v4
      
    # 2. JAVA BEÃLLÃTÃSA
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    # 3. A KURVA GRADLE WRAPPER MEGJAVÃTÃSA
    - name: Fix the fucking Gradle wrapper
      run: |
        echo "ğŸ¯ 1. ELÅSZÃ–R MINDENT KITÃ–RÃ–LÃœNK!"
        rm -rf gradle/wrapper/* 2>/dev/null || true
        mkdir -p gradle/wrapper
        
        echo "ğŸ“ 2. gradle-wrapper.properties LÃ‰TREHOZÃSA"
        cat > gradle/wrapper/gradle-wrapper.properties << 'EOF'
        distributionBase=GRADLE_USER_HOME
        distributionPath=wrapper/dists
        distributionUrl=https\://services.gradle.org/distributions/gradle-8.4-bin.zip
        zipStoreBase=GRADLE_USER_HOME
        zipStorePath=wrapper/dists
        EOF
        
        echo "â¬‡ï¸  3. A KIBASZOTT GRADLE-WRAPPER.JAR LETÃ–LTÃ‰SE"
        # PrÃ³bÃ¡ljuk a hÃ¡rom kÃ¼lÃ¶nbÃ¶zÅ‘ forrÃ¡st
        echo "   a) GitHub-rÃ³l prÃ³bÃ¡lom..."
        curl -L --fail https://github.com/gradle/gradle/raw/v8.4/gradle/wrapper/gradle-wrapper.jar \
          -o gradle/wrapper/gradle-wrapper.jar || echo "   âŒ GitHub nem mÅ±kÃ¶dik"
        
        # Ha nem sikerÃ¼lt vagy Ã¼res
        if [ ! -f gradle/wrapper/gradle-wrapper.jar ] || [ ! -s gradle/wrapper/gradle-wrapper.jar ]; then
          echo "   b) Maven Central-rÃ³l prÃ³bÃ¡lom..."
          curl -L https://repo.maven.apache.org/maven2/gradle/wrapper/gradle-wrapper/8.4/gradle-wrapper-8.4.jar \
            -o gradle/wrapper/gradle-wrapper.jar || echo "   âŒ Maven nem mÅ±kÃ¶dik"
        fi
        
        # Ha mÃ©g mindig nem jÃ³
        if [ ! -f gradle/wrapper/gradle-wrapper.jar ] || [ ! -s gradle/wrapper/gradle-wrapper.jar ]; then
          echo "   c) Direct letÃ¶ltÃ©s a gradle.org-rÃ³l..."
          curl -L https://services.gradle.org/distributions/gradle-8.4-bin.zip -o gradle.zip
          unzip -p gradle.zip gradle-8.4/lib/gradle-wrapper.jar > gradle/wrapper/gradle-wrapper.jar
          rm -f gradle.zip
        fi
        
        echo "âœ… 4. ELLENÅRZÃ‰S"
        echo "FÃ¡jlok a gradle/wrapper-ben:"
        ls -la gradle/wrapper/
        
        if [ -f gradle/wrapper/gradle-wrapper.jar ] && [ -s gradle/wrapper/gradle-wrapper.jar ]; then
          echo "ğŸ‰ GRATULÃLOK! A KURVA GRADLE-WRAPPER.JAR MEGVAN!"
          echo "MÃ©rete: $(wc -c < gradle/wrapper/gradle-wrapper.jar) bytes"
        else
          echo "ğŸ’¥ BASZDMEG, MÃ‰GSE MÅ°KÃ–DIK! GRADLE TELEPÃTÃ‰SE WRAPPER NÃ‰LKÃœL..."
          wget -q https://services.gradle.org/distributions/gradle-8.4-bin.zip
          unzip -q gradle-8.4-bin.zip
          export PATH=$PWD/gradle-8.4/bin:$PATH
          echo "Gradle telepÃ­tve, wrapper nÃ©lkÃ¼l fogunk buildelni"
        fi
        
    # 4. GRADLEW FUTTATHATÃ“VÃ TÃ‰TELE
    - name: Make gradlew executable
      run: chmod +x ./gradlew
      
    # 5. BUILDELÃ‰S
    - name: Build with Gradle
      run: |
        echo "ğŸš€ BUILD INDUL..."
        # Ha van wrapper, akkor azzal
        if [ -f gradle/wrapper/gradle-wrapper.jar ] && [ -s gradle/wrapper/gradle-wrapper.jar ]; then
          echo "Wrapper-rel buildelÃ¼nk"
          ./gradlew assembleDebug --stacktrace --no-daemon
        else
          echo "Wrapper nÃ©lkÃ¼l buildelÃ¼nk"
          ./gradle-8.4/bin/gradle assembleDebug --stacktrace --no-daemon
        fi
      
    # 6. APK FELTÃ–LTÃ‰SE
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: app-debug
        path: app/build/outputs/apk/debug/*.apk
        
    # 7. BUILD INFO (extra)
    - name: Show build info
      run: |
        echo "ğŸ“Š BUILD INFO:"
        echo "APK fÃ¡jlok:"
        find app/build/outputs/apk/ -name "*.apk" 2>/dev/null || echo "Nincs APK"
        echo "Build vÃ©ge!"
